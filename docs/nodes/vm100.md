# VM100 Services (GPU / Media)

This document describes the current containerized media services running on VM100 (Compute/GPU VM).

## Jellyfin

- Deployment: Docker Compose (`/opt/docker/jellyfin/docker-compose.yml` on VM100)
- GPU acceleration: enabled (`gpus: all` + NVIDIA environment variables)
- Runs as non-root user (`user: 1000:1000`)
- Persistent application data:
  - `/mnt/vm-data/jellyfin/config` -> `/config`
  - `/mnt/vm-data/jellyfin/cache` -> `/cache`
  - `/mnt/vm-data/jellyfin/metadata` -> `/metadata`
- Media mounts (read-only, least privilege):
  - `/media/jellyfin/Filme` -> `/media/Filme:ro`
  - `/media/jellyfin/Serien` -> `/media/Serien:ro`
- Port exposure: `8096/TCP` (LAN)

## Audiobookshelf

- Deployment: Docker Compose (`/opt/docker/audiobookshelf/docker-compose.yml` on VM100)
- Media mounts (read-only, least privilege):
  - `/media/audiobookshelf/Audiobooks` -> `/audiobooks:ro`
  - `/media/audiobookshelf/Podcasts` -> `/podcasts:ro`
- Port exposure: `13378/TCP` (LAN)

## Storage Mount Strategy (Reboot-Safe)

Media paths on VM100 are provided via **systemd automount** units (fstype `autofs`) to ensure reboot-safe startup behavior:
- `/media/jellyfin`
- `/media/audiobookshelf`

Note: A legacy `media-mergerfs.mount` unit exists on VM100 but is not used for service mounts in the current state.

## Security / Exposure Notes (Trade-off)

- No public reverse proxy and no router port-forwarding.
- Default remote access path is Tailscale (identity-based overlay).
- Network policy enforcement is defined via Tailscale ACL (tags + JSON policy).
  See: [docs/platform/tailscale-acl.md](../platform/tailscale-acl.md)

### Intentional LAN Exposure

- Jellyfin (`8096/TCP`) and Audiobookshelf (`13378/TCP`) are intentionally reachable on the LAN.
- This is a documented performance trade-off (bandwidth/latency optimization and reduced transcoding load).
- LAN exposure must remain limited to these specific ports only.
